CVE-2010-1760
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/ChangeLog
@@ -0,0 +1,21 @@
+2010-04-28  Julien Chaffraix  <jchaffraix@webkit.org>
+
+        Reviewed by Alexey Proskuryakov.
+
+        [XHR] Cross-Origin synchronous request with credential raises NETWORK_ERR
+        https://bugs.webkit.org/show_bug.cgi?id=37781
+        <rdar://problem/7905150>
+
+        Test that doing a cross-origin request with a preflight check does
+        not raise a NETWORK_ERR exception and does not send the credentials.
+
+        * http/tests/xmlhttprequest/access-control-preflight-credential-async-expected.txt: Added.
+        * http/tests/xmlhttprequest/access-control-preflight-credential-async.html: Added.
+        * http/tests/xmlhttprequest/access-control-preflight-credential-sync-expected.txt: Added.
+        * http/tests/xmlhttprequest/access-control-preflight-credential-sync.html: Added.
+        * http/tests/xmlhttprequest/resources/basic-auth/access-control-auth-basic.php: Added.
+
+        * platform/mac-tiger/Skipped:
+        * platform/qt/Skipped:
+        Added those 2 tests to the Skipped lists.
+
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/http/tests/xmlhttprequest/access-control-preflight-credential-async-expected.txt
@@ -0,0 +1,4 @@
+Test case for bug 37781: [XHR] Cross-Origin synchronous request with credential raises NETWORK_ERR
+
+PASSED
+
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/http/tests/xmlhttprequest/access-control-preflight-credential-async.html
@@ -0,0 +1,37 @@
+<html>
+<body>
+<p>Test case for bug <a href="https://bugs.webkit.org/show_bug.cgi?id=37781">37781</a>: [XHR] Cross-Origin synchronous request with credential raises NETWORK_ERR</p>
+<pre id='console'></pre>
+<script type="text/javascript">
+function log(message)
+{
+    document.getElementById('console').appendChild(document.createTextNode(message + "\n"));
+}
+
+if (window.layoutTestController) {
+    layoutTestController.dumpAsText();
+    layoutTestController.waitUntilDone();
+}
+
+try {
+    var xhr = new XMLHttpRequest;
+    xhr.open("PUT", "http://localhost:8000/xmlhttprequest/resources/basic-auth/access-control-auth-basic.php?uid=fooUser", false, "fooUser", "barPass");
+    xhr.onerror = function (e) {
+        log("FAILED: received error");
+        if (window.layoutTestController)
+            layoutTestController.notifyDone();
+    };
+    xhr.onreadystatechange = function () {
+        if (xhr.readyState == 4) {
+            log((xhr.status == 401) ? "PASSED" : "FAILED: credential send!");
+            if (window.layoutTestController)
+                layoutTestController.notifyDone();
+        }
+    };
+    xhr.send();
+} catch(e) {
+    log("FAILED: got exception " + e.message);
+}
+</script>
+</body>
+</html>
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/http/tests/xmlhttprequest/access-control-preflight-credential-sync-expected.txt
@@ -0,0 +1,4 @@
+Test case for bug 37781: [XHR] Cross-Origin synchronous request with credential raises NETWORK_ERR
+
+PASSED
+
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/http/tests/xmlhttprequest/access-control-preflight-credential-sync.html
@@ -0,0 +1,37 @@
+<html>
+<body>
+<p>Test case for bug <a href="https://bugs.webkit.org/show_bug.cgi?id=37781">37781</a>: [XHR] Cross-Origin synchronous request with credential raises NETWORK_ERR</p>
+<pre id='console'></pre>
+<script type="text/javascript">
+function log(message)
+{
+    document.getElementById('console').appendChild(document.createTextNode(message + "\n"));
+}
+
+if (window.layoutTestController) {
+    layoutTestController.dumpAsText();
+    layoutTestController.waitUntilDone();
+}
+
+try {
+    var xhr = new XMLHttpRequest;
+    xhr.open("PUT", "http://localhost:8000/xmlhttprequest/resources/basic-auth/access-control-auth-basic.php?uid=fooUser", false, "fooUser", "barPass");
+    xhr.onerror = function (e) {
+        log("FAILED: received error");
+        if (window.layoutTestController)
+            layoutTestController.notifyDone();
+    };
+    xhr.onreadystatechange = function () {
+        if (xhr.readyState == 4) {
+            log((xhr.status == 401) ? "PASSED" : "FAILED: credential send!");
+            if (window.layoutTestController)
+                layoutTestController.notifyDone();
+        }
+    };
+    xhr.send();
+} catch(e) {
+    log("FAILED: got exception " + e.message);
+}
+</script>
+</body>
+</html>
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/http/tests/xmlhttprequest/resources/basic-auth/access-control-auth-basic.php
@@ -0,0 +1,17 @@
+<?php
+
+header("Access-Control-Allow-Origin: http://127.0.0.1:8000/");
+header("Access-Control-Allow-Credentials: true");
+header("Access-Control-Allow-Methods: PUT");
+
+if ($_SERVER['REQUEST_METHOD'] != "OPTIONS") {
+    if (!isset($_SERVER['PHP_AUTH_USER']) || !isset($_REQUEST['uid']) || ($_REQUEST['uid'] != $_SERVER['PHP_AUTH_USER'])) {
+        header('WWW-Authenticate: Basic realm="WebKit Test Realm/Cross Origin"');
+        header('HTTP/1.0 401 Unauthorized');
+        echo 'Authentication canceled';
+        exit;
+    } else {
+        echo "User: {$_SERVER['PHP_AUTH_USER']}, password: {$_SERVER['PHP_AUTH_PW']}.";
+    }
+}
+?>
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/platform/mac-tiger/Skipped
@@ -0,0 +1,5 @@
+
+# https://bugs.webkit.org/show_bug.cgi?id=38265
+# LayoutTests/http/tests/xmlhttprequest/access-control-preflight-credential-[a]sync.html fails on Tiger
+http/tests/xmlhttprequest/access-control-preflight-credential-async.html
+http/tests/xmlhttprequest/access-control-preflight-credential-sync.html
--- /dev/null
+++ b/src/third_party/WebKit/LayoutTests/platform/qt/Skipped
@@ -0,0 +1,2 @@
+http/tests/xmlhttprequest/access-control-preflight-credential-async.html
+http/tests/xmlhttprequest/access-control-preflight-credential-sync.html
