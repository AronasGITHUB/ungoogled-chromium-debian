Index: exp/src/chrome/app/policy/cloud_policy_codegen.gyp
===================================================================
--- exp.orig/src/chrome/app/policy/cloud_policy_codegen.gyp	2012-05-19 16:54:41.000000000 +0200
+++ exp/src/chrome/app/policy/cloud_policy_codegen.gyp	2012-05-29 14:22:19.006236717 +0200
@@ -115,7 +115,7 @@
         'cloud_policy_proto_compile',
         'cloud_policy_backend_header_compile',
         '<(DEPTH)/base/base.gyp:base',
-        '<(DEPTH)/third_party/protobuf/protobuf.gyp:protobuf_lite',
+        '<(DEPTH)/build/linux/system.gyp:protobuf',
       ],
     },
   ],
Index: exp/src/chrome/chrome_browser.gypi
===================================================================
--- exp.orig/src/chrome/chrome_browser.gypi	2012-05-28 09:38:34.000000000 +0200
+++ exp/src/chrome/chrome_browser.gypi	2012-05-29 14:22:19.006236717 +0200
@@ -4843,8 +4843,7 @@
             ['chromeos==1',{
               'dependencies': [
                 '../dbus/dbus.gyp:dbus',
-                '../third_party/protobuf/protobuf.gyp:protobuf_lite',
-                '../third_party/protobuf/protobuf.gyp:protoc#host',
+                '../build/linux/system.gyp:protobuf',
               ],
               'conditions': [
                 ['system_libcros==0', {
Index: exp/src/net/net.gyp
===================================================================
--- exp.orig/src/net/net.gyp	2012-05-19 16:54:19.000000000 +0200
+++ exp/src/net/net.gyp	2012-05-29 14:22:19.006236717 +0200
@@ -1539,7 +1539,7 @@
             '../chrome/app/policy/cloud_policy_codegen.gyp:cloud_policy_proto_compile',
             # The test server uses Python modules generated by the sync protos.
             '../sync/protocol/sync_proto.gyp:sync_proto',
-            '../third_party/protobuf/protobuf.gyp:py_proto',
+            '../build/linux/system.gyp:protobuf',
           ],
         }],
         ['os_posix == 1 and OS != "mac" and OS != "android"', {
Index: exp/src/remoting/remoting.gyp
===================================================================
--- exp.orig/src/remoting/remoting.gyp	2012-05-29 14:22:01.046237146 +0200
+++ exp/src/remoting/remoting.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -1046,7 +1046,7 @@
         '../net/net.gyp:net',
         '../skia/skia.gyp:skia',
         '../third_party/libvpx/libvpx.gyp:libvpx',
-        '../third_party/protobuf/protobuf.gyp:protobuf_lite',
+        '../build/linux/system.gyp:protobuf',
         '../third_party/zlib/zlib.gyp:zlib',
         '../media/media.gyp:yuv_convert',
         'remoting_jingle_glue',
@@ -1056,7 +1056,7 @@
         '../base/base.gyp:base',
         '../net/net.gyp:net',
         '../skia/skia.gyp:skia',
-        '../third_party/protobuf/protobuf.gyp:protobuf_lite',
+        '../build/linux/system.gyp:protobuf',
         'proto/chromotocol.gyp:chromotocol_proto_lib',
       ],
       # This target needs a hard dependency because dependent targets
Index: exp/src/third_party/cacheinvalidation/cacheinvalidation.gyp
===================================================================
--- exp.orig/src/third_party/cacheinvalidation/cacheinvalidation.gyp	2012-05-19 16:54:27.000000000 +0200
+++ exp/src/third_party/cacheinvalidation/cacheinvalidation.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -18,7 +18,7 @@
     # Where files generated from proto files are put.
     'protoc_out_dir': '<(SHARED_INTERMEDIATE_DIR)/protoc_out',
     # The path to the protoc executable.
-    'protoc': '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)protoc<(EXECUTABLE_SUFFIX)',
+    'protoc': '/usr/bin/protoc',
   },
   'targets': [
     # The rule/action to generate files from the cacheinvalidation proto
@@ -58,7 +58,7 @@
         },
       ],
       'dependencies': [
-        '../../third_party/protobuf/protobuf.gyp:protoc#host',
+        '../../build/linux/system.gyp:protobuf',
       ],
     },
     # The C++ files generated from the cache invalidation protocol buffers.
@@ -78,7 +78,7 @@
         '<(protoc_out_dir)/<(proto_dir_relpath)/types.pb.cc',
       ],
       'dependencies': [
-        '../../third_party/protobuf/protobuf.gyp:protobuf_lite',
+        '../../build/linux/system.gyp:protobuf',
         'cacheinvalidation_proto',
       ],
       'include_dirs': [
@@ -90,7 +90,7 @@
         ],
       },
       'export_dependent_settings': [
-        '../../third_party/protobuf/protobuf.gyp:protobuf_lite',
+        '../../build/linux/system.gyp:protobuf',
       ],
       # This target exports a hard dependency because it contains generated
       # header files.
Index: exp/src/third_party/safe_browsing/safe_browsing.gyp
===================================================================
--- exp.orig/src/third_party/safe_browsing/safe_browsing.gyp	2012-05-19 16:54:32.000000000 +0200
+++ exp/src/third_party/safe_browsing/safe_browsing.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -13,10 +13,10 @@
         'testing/testing_input.dat',
       ],
       'export_dependent_settings': [
-        '../protobuf/protobuf.gyp:py_proto',
+        '../../build/linux/system.gyp:protobuf',
       ],
       'dependencies': [
-        '../protobuf/protobuf.gyp:py_proto',
+        '../../build/linux/system.gyp:protobuf',
       ],
      },
   ],
Index: exp/src/build/linux/system.gyp
===================================================================
--- exp.orig/src/build/linux/system.gyp	2012-05-29 14:22:18.926236719 +0200
+++ exp/src/build/linux/system.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -447,6 +447,26 @@
       ],
     },
     {
+      'target_name': 'protobuf',
+      'type': 'none',
+      'conditions': [
+        ['_toolset=="target"', {
+          'direct_dependent_settings': {
+            'cflags': [
+              '<!@(pkg-config --cflags protobuf)',
+            ],
+          },
+          'link_settings': {
+            'ldflags': [
+              '<!@(pkg-config --libs-only-L --libs-only-other protobuf)',
+            ],
+            'libraries': [
+              '<!@(pkg-config --libs-only-l protobuf)',
+            ],
+          },
+      }]]
+    },
+    {
       # The unit tests use a few convenience functions from the GNOME
       # Keyring library directly. We ignore linux_link_gnome_keyring and
       # link directly in this version of the target to allow this.
Index: exp/src/chrome/chrome_browser_extensions.gypi
===================================================================
--- exp.orig/src/chrome/chrome_browser_extensions.gypi	2012-05-19 16:55:35.000000000 +0200
+++ exp/src/chrome/chrome_browser_extensions.gypi	2012-05-29 14:22:19.010236718 +0200
@@ -634,8 +634,7 @@
               ],
               'dependencies': [
                 '../dbus/dbus.gyp:dbus',
-                '../third_party/protobuf/protobuf.gyp:protobuf_lite',
-                '../third_party/protobuf/protobuf.gyp:protoc#host',
+                '../build/linux/system.gyp:protobuf',
               ],
               'conditions': [
                 ['system_libcros==0', {
Index: exp/src/dbus/dbus.gyp
===================================================================
--- exp.orig/src/dbus/dbus.gyp	2012-05-19 16:54:07.000000000 +0200
+++ exp/src/dbus/dbus.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -13,7 +13,7 @@
       'dependencies': [
         '../base/base.gyp:base',
         '../build/linux/system.gyp:dbus',
-        '../third_party/protobuf/protobuf.gyp:protobuf_lite',
+        '../build/linux/system.gyp:protobuf',
       ],
       'export_dependent_settings': [
         '../base/base.gyp:base',
Index: exp/src/third_party/mozc/chrome/chromeos/renderer/chromeos_renderer.gyp
===================================================================
--- exp.orig/src/third_party/mozc/chrome/chromeos/renderer/chromeos_renderer.gyp	2012-05-19 16:56:41.000000000 +0200
+++ exp/src/third_party/mozc/chrome/chromeos/renderer/chromeos_renderer.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -73,14 +73,14 @@
           'rule_name': 'genproto',
           'extension': 'proto',
           'inputs': [
-            '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)protoc<(EXECUTABLE_SUFFIX)',
+            '/usr/bin/protoc',
           ],
           'outputs': [
             '<(protoc_out_dir)/third_party/mozc/session/<(RULE_INPUT_ROOT).pb.h',
             '<(protoc_out_dir)/third_party/mozc/session/<(RULE_INPUT_ROOT).pb.cc',
           ],
           'action': [
-            '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)protoc<(EXECUTABLE_SUFFIX)',
+            '/usr/bin/protoc',
             '--proto_path=<(third_party_dir)/mozc',
             '<(third_party_dir)/mozc/session/<(RULE_INPUT_ROOT)<(RULE_INPUT_EXT)',
             '--cpp_out=<(protoc_out_dir)/third_party/mozc',
@@ -91,8 +91,7 @@
       ],
       'dependencies': [
         'litify_mozc_proto_files',
-        '<(third_party_dir)/protobuf/protobuf.gyp:protobuf_lite',
-        '<(third_party_dir)/protobuf/protobuf.gyp:protoc#host',
+        '../../../../../build/linux/system.gyp:protobuf',
       ],
       'include_dirs': [
         '<(protoc_out_dir)/third_party/mozc',
@@ -103,7 +102,7 @@
         ]
       },
       'export_dependent_settings': [
-        '<(third_party_dir)/protobuf/protobuf.gyp:protobuf_lite',
+        '../../../../../build/linux/system.gyp:protobuf',
       ],
     },
     {
Index: exp/src/third_party/webrtc/build/protoc.gypi
===================================================================
--- exp.orig/src/third_party/webrtc/build/protoc.gypi	2012-05-28 09:38:46.000000000 +0200
+++ exp/src/third_party/webrtc/build/protoc.gypi	2012-05-29 14:22:19.010236718 +0200
@@ -44,7 +44,7 @@
 
 {
   'variables': {
-    'protoc': '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)protoc<(EXECUTABLE_SUFFIX)',
+    'protoc': '/usr/bin/protoc',
     'cc_dir': '<(SHARED_INTERMEDIATE_DIR)/protoc_out/<(proto_out_dir)',
     'py_dir': '<(PRODUCT_DIR)/pyproto/<(proto_out_dir)',
     'proto_in_dir%': '.',
@@ -75,8 +75,7 @@
     },
   ],
   'dependencies': [
-    '<(DEPTH)/third_party/protobuf/protobuf.gyp:protoc#host',
-    '<(DEPTH)/third_party/protobuf/protobuf.gyp:protobuf_lite',
+    '<(DEPTH)/build/linux/system.gyp:protobuf',
   ],
   'include_dirs': [
     '<(SHARED_INTERMEDIATE_DIR)/protoc_out',
@@ -89,7 +88,7 @@
   'export_dependent_settings': [
     # The generated headers reference headers within protobuf_lite,
     # so dependencies must be able to find those headers too.
-    '<(DEPTH)/third_party/protobuf/protobuf.gyp:protobuf_lite',
+    '<(DEPTH)/build/linux/system.gyp:protobuf',
   ],
   # This target exports a hard dependency because it generates header
   # files.
Index: exp/src/third_party/mozc/session/session.gyp
===================================================================
--- exp.orig/src/third_party/mozc/session/session.gyp	2012-05-19 16:56:45.000000000 +0200
+++ exp/src/third_party/mozc/session/session.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -70,7 +70,7 @@
       'dependencies': [
         '../composer/composer.gyp:composer',
         '../config/config.gyp:genproto_config',
-        '../protobuf/protobuf.gyp:protobuf',
+        '../../build/linux/system.gyp:protobuf',
         'session_base.gyp:genproto_session',
         'session_base.gyp:session_protocol',
       ],
Index: exp/src/third_party/mozc/session/session_base.gyp
===================================================================
--- exp.orig/src/third_party/mozc/session/session_base.gyp	2012-05-19 16:56:45.000000000 +0200
+++ exp/src/third_party/mozc/session/session_base.gyp	2012-05-29 14:22:19.010236718 +0200
@@ -118,7 +118,7 @@
         '<(proto_out_dir)/<(relative_dir)/state.pb.cc',
       ],
       'dependencies': [
-        '../protobuf/protobuf.gyp:protobuf',
+        '../../build/linux/system.gyp:protobuf',
         'genproto_session',
         '../config/config.gyp:config_protocol',
       ],
